<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HFSP-and-AGV-scheduling-based-on-genetic-algorithm</title>
    <link rel="stylesheet" href="dhtmlxgantt.css" type="text/css">
    <script src="dhtmlxgantt.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #button-container {

            display: flex;

            justify-content: center;

            align-items: center;

            width: 100%;

            height: 50px; /* 设置一个高度 */

            background-color: #007bff; /* 背景颜色 */

            color: #fff; /* 文字颜色 */

            position: fixed; /* 固定在页面顶部 */

            top: 0; /* 顶部位置 */

            left: 0;

            z-index: 1000; /* 确保在gantt图上方 */

        }



        #button-container:hover {

            background-color: #0056b3; /* 鼠标悬停时的背景颜色 */

        }



        #toggleRenderButton {

            color: #fff; /* 文字颜色 */

            background: none; /* 无背景 */

            border: none; /* 无边框 */

            padding: 0; /* 无内边距 */

            font-size: 40px; /* 字体大小 */
            width: 100%;

            cursor: pointer; /* 鼠标指针 */

            text-transform: uppercase; /* 大小写字母 */

            letter-spacing: 0.05em; /* 字母间距 */

        }



        #gantt_here {

            width: 100%;

            height: calc(100vh - 50px);

            position: fixed; /* 修改为fixed定位 */

            top: 50px; /* 给gantt图顶部留出按钮的高度 */

            left: 0; /* 确保元素从视口的左侧开始 */

            overflow-y: auto; /* 如果内容超出，则显示垂直滚动条 */

        }

        .gantt_tree {

            text-align: left; /* 任务名称左对齐 */

        }



        .gantt_grid_data {

            text-align: center; /* 其他数值列居中对齐 */

        }


        .gantt_task_content {

            font-weight: bold !important;

            font-size: 13px;

        }


    </style>
</head>
<body>

<div id="button-container">

    <button id="toggleRenderButton">Scheduling Gantt Chart</button>

</div>



<div id="gantt_here" style=""></div>


<script>
    gantt.config.columns = [

        {name: "text", label: "Meachines", width: 130, tree: true}, // tree: true 以显示展开图标

        {name: "start_date", label: "Start Time", width: 80, template: gantt.formatDate},

        {name: "duration", label: "Duration", width: 70},

        {name: "use_rate", label: "Use Rate", width: 70},

        {name: "wait_rate", label: "Wait Rate", width:70},

        {name: "block_rate", label: "Block Rate", width:70},

    ];


    gantt.config.duration_unit = "minute"; // Set duration unit to seconds

    gantt.config.date_format = "%Y-%m-%d %H:%i:%s"; // 确保刻度和时间线上显示时分秒

    gantt.config.task_date_format = "%Y-%m-%d %H:%i:%s"; // 确保任务列表中显示时分秒

    gantt.config.date_scale = "%H:%i";
    gantt.config.scale_unit = "minute";

    gantt.config.scale_height = 40; // Set scale height for each machine

    gantt.config.row_height = 40; // Set row height for each task

    gantt.config.min_column_width = 35; // Minimum width for the columns

    //gantt.config.readonly = true;
    var meachine_ganttData = [[[12, 48.0, 119.0, 1], [6, 119.0, 190.0, 1], [15, 190.0, 281.0, 1], [20, 281.0, 318.0, 1], [13, 318.0, 392.0, 1], [5, 392.0, 485.0, 1]], [[1, 50.0, 77.0, 1], [10, 77.0, 145.0, 1], [2, 145.0, 181.0, 1], [14, 181.0, 246.0, 1], [7, 246.0, 287.0, 1], [11, 287.0, 347.0, 1], [17, 347.0, 371.0, 1], [18, 371.0, 465.0, 1]], [[19, 53.0, 106.0, 1], [16, 106.0, 188.0, 1], [8, 188.0, 263.0, 1], [9, 263.0, 328.0, 1], [4, 328.0, 373.0, 1], [3, 373.0, 428.0, 1]], [[1, 117.0, 130.0, 2], [12, 130.0, 137.0, 2], [10, 150.0, 182.0, 2], [16, 190.0, 258.0, 2], [14, 258.0, 326.0, 2], [15, 326.0, 403.0, 2], [20, 403.0, 427.0, 2], [11, 427.0, 459.0, 2], [17, 459.0, 546.0, 2], [13, 546.0, 630.0, 2], [5, 630.0, 684.0, 2]], [[19, 113.0, 153.0, 2], [2, 188.0, 221.0, 2], [6, 221.0, 280.0, 2], [8, 280.0, 349.0, 2], [7, 349.0, 404.0, 2], [9, 404.0, 479.0, 2], [4, 479.0, 565.0, 2], [3, 565.0, 626.0, 2], [18, 626.0, 667.0, 2]], [[1, 135.0, 218.0, 3], [16, 263.0, 308.0, 3], [14, 331.0, 427.0, 3], [7, 427.0, 483.0, 3], [9, 483.0, 494.0, 3], [4, 568.0, 620.0, 3], [13, 635.0, 667.0, 3]], [[12, 150.0, 152.0, 3], [10, 198.0, 221.0, 3], [6, 288.0, 331.0, 3], [15, 413.0, 488.0, 3], [17, 556.0, 629.0, 3], [18, 675.0, 682.0, 3], [5, 694.0, 724.0, 3]], [[19, 172.0, 178.0, 3], [2, 235.0, 330.0, 3], [8, 363.0, 442.0, 3], [20, 443.0, 466.0, 3], [11, 475.0, 497.0, 3], [3, 640.0, 667.0, 3]], [[12, 209.0, 236.0, 4], [1, 255.0, 348.0, 4], [16, 348.0, 422.0, 4], [14, 443.0, 513.0, 4], [7, 513.0, 587.0, 4], [9, 587.0, 652.0, 4], [17, 652.0, 701.0, 4], [18, 701.0, 733.0, 4], [5, 735.0, 739.0, 4]], [[19, 221.0, 245.0, 4], [10, 279.0, 364.0, 4], [2, 364.0, 382.0, 4], [6, 382.0, 470.0, 4], [8, 470.0, 511.0, 4], [20, 511.0, 544.0, 4], [15, 544.0, 610.0, 4], [11, 610.0, 638.0, 4], [4, 638.0, 682.0, 4], [3, 682.0, 689.0, 4], [13, 689.0, 752.0, 4]]];
    var agv_ganttData =[[[0, 0.0, 42.0, 11, 0], [12, 42.0, 48.0, 0, 1], [0, 48.0, 54.0, 1, 0], [16, 54.0, 65.0, 0, 3], [0, 65.0, 76.0, 3, 0], [7, 76.0, 84.0, 0, 2], [0, 84.0, 92.0, 2, 0], [11, 92.0, 100.0, 0, 2], [0, 100.0, 108.0, 2, 0], [3, 108.0, 119.0, 0, 3], [0, 142.0, 145.0, 3, 2], [10, 145.0, 150.0, 2, 4], [0, 176.0, 181.0, 4, 2], [2, 181.0, 188.0, 2, 5], [0, 239.0, 246.0, 5, 2], [14, 246.0, 251.0, 2, 4], [0, 261.0, 263.0, 4, 3], [8, 263.0, 267.0, 3, 5], [0, 272.0, 281.0, 5, 1], [15, 281.0, 288.0, 1, 4], [0, 311.0, 318.0, 4, 1], [20, 318.0, 325.0, 1, 4], [0, 326.0, 328.0, 4, 3], [9, 328.0, 332.0, 3, 5], [0, 340.0, 347.0, 5, 2], [11, 347.0, 352.0, 2, 4], [0, 366.0, 371.0, 4, 2], [17, 371.0, 376.0, 2, 4], [0, 385.0, 392.0, 4, 1], [13, 392.0, 399.0, 1, 4], [0, 426.0, 428.0, 4, 3], [3, 428.0, 432.0, 3, 5], [0, 458.0, 465.0, 5, 2], [18, 465.0, 472.0, 2, 5], [0, 476.0, 485.0, 5, 1], [5, 485.0, 492.0, 1, 4], [0, 546.0, 546.0, 4, 4], [17, 546.0, 556.0, 4, 7], [0, 557.0, 565.0, 7, 5], [4, 565.0, 568.0, 5, 6], [0, 623.0, 626.0, 6, 5], [3, 626.0, 640.0, 5, 8], [0, 653.0, 667.0, 8, 5], [18, 667.0, 675.0, 5, 7], [0, 682.0, 682.0, 7, 7], [18, 682.0, 693.0, 7, 9], [0, 713.0, 724.0, 9, 7], [5, 724.0, 735.0, 7, 9]], [[0, 0.0, 42.0, 11, 0], [1, 42.0, 50.0, 0, 2], [0, 50.0, 58.0, 2, 0], [6, 58.0, 64.0, 0, 1], [0, 64.0, 70.0, 1, 0], [8, 70.0, 81.0, 0, 3], [0, 81.0, 92.0, 3, 0], [13, 92.0, 98.0, 0, 1], [0, 98.0, 104.0, 1, 0], [18, 104.0, 112.0, 0, 2], [0, 112.0, 112.0, 2, 2], [1, 112.0, 117.0, 2, 4], [0, 186.0, 188.0, 4, 3], [16, 188.0, 190.0, 3, 4], [0, 282.0, 287.0, 4, 2], [7, 287.0, 294.0, 2, 5], [0, 369.0, 373.0, 5, 3], [4, 373.0, 377.0, 3, 5], [0, 401.0, 403.0, 5, 4], [15, 403.0, 413.0, 4, 7], [0, 417.0, 427.0, 7, 4], [20, 427.0, 443.0, 4, 8], [0, 443.0, 459.0, 8, 4], [11, 459.0, 475.0, 4, 8], [0, 614.0, 630.0, 8, 4], [13, 630.0, 635.0, 4, 6], [0, 679.0, 684.0, 6, 4], [5, 684.0, 694.0, 4, 7]], [[0, 0.0, 42.0, 11, 0], [19, 42.0, 53.0, 0, 3], [0, 53.0, 64.0, 3, 0], [14, 64.0, 72.0, 0, 2], [0, 72.0, 80.0, 2, 0], [9, 80.0, 91.0, 0, 3], [0, 91.0, 102.0, 3, 0], [17, 102.0, 110.0, 0, 2], [0, 110.0, 118.0, 2, 0], [5, 118.0, 124.0, 0, 1], [0, 190.0, 190.0, 1, 1], [6, 190.0, 199.0, 1, 5], [0, 221.0, 221.0, 5, 5], [2, 221.0, 235.0, 5, 8], [0, 242.0, 258.0, 8, 4], [16, 258.0, 263.0, 4, 6], [0, 277.0, 280.0, 6, 5], [6, 280.0, 288.0, 5, 7], [0, 316.0, 326.0, 7, 4], [14, 326.0, 331.0, 4, 6], [0, 346.0, 349.0, 6, 5], [8, 349.0, 363.0, 5, 8], [0, 390.0, 404.0, 8, 5], [7, 404.0, 407.0, 5, 6], [0, 476.0, 479.0, 6, 5], [9, 479.0, 482.0, 5, 6], [0, 483.0, 483.0, 6, 6], [7, 483.0, 499.0, 6, 9], [0, 499.0, 515.0, 9, 6], [9, 515.0, 531.0, 6, 9], [0, 604.0, 620.0, 9, 6], [4, 620.0, 638.0, 6, 10], [0, 660.0, 667.0, 10, 8], [3, 667.0, 674.0, 8, 10]], [[0, 0.0, 42.0, 11, 0], [10, 42.0, 50.0, 0, 2], [0, 50.0, 58.0, 2, 0], [2, 58.0, 66.0, 0, 2], [0, 66.0, 74.0, 2, 0], [15, 74.0, 80.0, 0, 1], [0, 80.0, 86.0, 1, 0], [20, 86.0, 92.0, 0, 1], [0, 92.0, 98.0, 1, 0], [4, 98.0, 109.0, 0, 3], [0, 109.0, 109.0, 3, 3], [19, 109.0, 113.0, 3, 5], [0, 113.0, 122.0, 5, 1], [12, 122.0, 129.0, 1, 4], [0, 130.0, 130.0, 4, 4], [1, 130.0, 135.0, 4, 6], [0, 135.0, 140.0, 6, 4], [12, 140.0, 150.0, 4, 7], [0, 150.0, 158.0, 7, 5], [19, 158.0, 172.0, 5, 8], [0, 172.0, 188.0, 8, 4], [10, 188.0, 198.0, 4, 7], [0, 198.0, 198.0, 7, 7], [12, 198.0, 209.0, 7, 9], [0, 209.0, 214.0, 9, 8], [19, 214.0, 221.0, 8, 10], [0, 221.0, 239.0, 10, 6], [1, 239.0, 255.0, 6, 9], [0, 255.0, 266.0, 9, 7], [10, 266.0, 279.0, 7, 10], [0, 290.0, 308.0, 10, 6], [16, 308.0, 324.0, 6, 9], [0, 325.0, 330.0, 9, 8], [2, 330.0, 337.0, 8, 10], [0, 337.0, 350.0, 10, 7], [6, 350.0, 363.0, 7, 10], [0, 409.0, 427.0, 10, 6], [14, 427.0, 443.0, 6, 9], [0, 443.0, 448.0, 9, 8], [8, 448.0, 455.0, 8, 10], [0, 459.0, 466.0, 10, 8], [20, 466.0, 473.0, 8, 10], [0, 475.0, 488.0, 10, 7], [15, 488.0, 501.0, 7, 10], [0, 501.0, 508.0, 10, 8], [11, 508.0, 515.0, 8, 10], [0, 616.0, 629.0, 10, 7], [17, 629.0, 640.0, 7, 9], [0, 651.0, 667.0, 9, 6], [13, 667.0, 685.0, 6, 10]]];
    var wait_rate =[0.0, 0.0, 0.0, 0.037037037037037035, 0.0631768953068592, 0.2951127819548872, 0.5592334494773519, 0.4909090909090909, 0.07924528301886792, 0.064030131826742];
    var block_rate =[0.7505720823798627, 0.7734939759036145, 0.8213333333333334, 0.6172839506172839, 0.6624548736462094, 0.039473684210526314, 0.0, 0.0, 0.21509433962264152, 0.3935969868173258];
    var agv_block_rate =[0.1360544217687075, 0.16138328530259366, 0.17062314540059348, 0.291970802919708];



    var colors = [

        "#808080", // 灰色

        "#15b01a", "#0343df", "#e50000", "#f97306", "#653700", "#f29591", "#00ffff", "#6e750e",

        "#a03623", "#fac205", "#bf9005", "#029386", "#214761", "#ffd1df", "#e6daa6",

        "#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b", "#e377c2", "#7f7f7f",

        "#bcbd22", "#17becf", "#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b",

        "#e377c2", "#ff7f7f", "#bcbd22", "#1fbecf"

    ];




    gantt.init("gantt_here");
    // 定义一个函数来切换render属性

    function toggleRender(m_index) {

        var taskId = m_index;

        var task = gantt.getTask(taskId);

        if (task) {

            task.render = task.render === 'split' ? 'box' : 'split';

            gantt.updateTask(taskId);

        }

    }



    // 给按钮添加点击事件监听器

    document.getElementById("toggleRenderButton").addEventListener("click", function() {

        // 假设你想要切换的任务索引是1（例如，"M1"）
        for (var m = 0; m < meachine_ganttData.length+agv_ganttData.length; m++) {
            toggleRender(m+1);
        }

// 重新计算甘特图的尺寸
        gantt.resize();
        // 滚动到甘特图的顶部
        gantt.scrollTo(0);

    });


    gantt.parse({

        data: (function () {

            var tasks = [];

            var taskIndex = 1;

            for (var m = 0; m < meachine_ganttData.length; m++) { // Iterate over machines
                var end_job = meachine_ganttData[m][meachine_ganttData[m].length - 1];
                var star_job = meachine_ganttData[m][0];
                var dur_time = end_job[2] - star_job[1]
                var m_index = m + 1

                var startDate = new Date(); // 获取当前日期和时间
                //var startDate = new Date();

                var startDays = star_job[1]; // 假设 job[1] 是要添加的天数
                function addDays(startDate, days) {

                    var result = new Date(startDate);

                    result.setDate(result.getDate() + days);
                    console.log(result)

                    return result;

                }
                function addMinutes(startDate, minutes) {

                    var result = new Date(startDate);



                    result.setMinutes(result.getMinutes() + minutes);

                    console.log(result);



                    return result;

                }

                var newStartDate = addMinutes(startDate, startDays);
                var wait=100*wait_rate[m]
                var block=100*block_rate[m]
                tasks.push({

                    id: taskIndex,

                    text: "M" + m_index,

                    start_date: newStartDate,//job[1],

                    duration: dur_time, // Convert days to seconds

                    parent: 0,

                    progress: 0.0,
                    wait_rate:wait.toFixed(2) + '%',
                    block_rate:block.toFixed(2) + '%',

                    open: false,
                    render: 'split',

                    color: '#007bff'// Job color

                });
                taskIndex++

            }

            for (var m = 0; m < agv_ganttData.length; m++) { // Iterate over machines
                var end_job = agv_ganttData[m][agv_ganttData[m].length - 1];
                var star_job = agv_ganttData[m][0];
                var dur_time = end_job[2] - star_job[1]
                var m_index = m + 1
                var block=100*agv_block_rate[m]
                var startDate = new Date(); // 获取当前日期和时间
                //var startDate = new Date();

                var startDays = star_job[1]; // 假设 job[1] 是要添加的天数
                function addDays(startDate, days) {

                    var result = new Date(startDate);

                    result.setDate(result.getDate() + days);
                    console.log(result)

                    return result;

                }
                function addMinutes(startDate, minutes) {

                    var result = new Date(startDate);



                    result.setMinutes(result.getMinutes() + minutes);

                    console.log(result);



                    return result;

                }

                var newStartDate = addMinutes(startDate, startDays);
                tasks.push({

                    id: taskIndex,

                    text: "AGV" + m_index,

                    start_date: newStartDate,//job[1],

                    duration: dur_time, // Convert days to seconds

                    parent: 0,
                    block_rate:block.toFixed(2) + '%',
                    progress: 0.0,

                    open: false,
                    render: 'split',

                    color: '#007bff'// Job color

                });
                taskIndex++

            }






            for (var m = 0; m < meachine_ganttData.length; m++) { // Iterate over machines
                var total_time=  meachine_ganttData[m][meachine_ganttData[m].length - 1][2]-meachine_ganttData[m][0][1];
                var use_time=0;

                for (var j = 0; j < meachine_ganttData[m].length; j++) { // Iterate over jobs

                    var job = meachine_ganttData[m][j];
                    use_time+=(job[2]-job[1]);

                    // 假设 startDate 是一个 Date 对象，days 是要添加的天数

                    function addDays(startDate, days) {

                        var result = new Date(startDate);

                        result.setDate(result.getDate() + days);
                        console.log(result)

                        return result;

                    }
                    function addMinutes(startDate, minutes) {

                        var result = new Date(startDate);



                        result.setMinutes(result.getMinutes() + minutes);

                        console.log(result);



                        return result;

                    }


// 使用示例

                    var startDate = new Date();

                    var jobDays = job[1]; // 假设 job[1] 是要添加的天数

                    var newStartDate = addMinutes(startDate, jobDays);


// 然后将 newStartDate 用作任务的开始日期
                    var op = "|T" + job[3] + '|'

                    tasks.push({

                        id: taskIndex++,

                        text: "J" + job[0] + op,

                        start_date: newStartDate,

                        duration: job[2] - job[1],

                        parent: m + 1,

                        progress: 0.0,

                        open: false,

                        color: colors[(job[0]) % colors.length]

                    });

                }
                var task=tasks[m]

                if (task) {

                    if (total_time !== 0) {

                        // 计算 use_rate 并保留两位小数

                        task.use_rate = (use_time / total_time * 100).toFixed(2) + '%';

                    } else {

                        // 如果 total_time 为 0，可以设置 use_rate 为 0% 或其他默认值

                        task.use_rate = '0%';

                    }

                }

            }



            for (var m = 0; m < agv_ganttData.length; m++) { // Iterate over machines
                var total_time=  agv_ganttData[m][agv_ganttData[m].length - 1][2]-agv_ganttData[m][0][1];
                var use_time=0;

                for (var j = 0; j < agv_ganttData[m].length; j++) { // Iterate over jobs

                    var job = agv_ganttData[m][j];
                    use_time+=(job[2]-job[1])

                    // 假设 startDate 是一个 Date 对象，days 是要添加的天数

                    function addDays(startDate, days) {

                        var result = new Date(startDate);

                        result.setDate(result.getDate() + days);
                        console.log(result)

                        return result;

                    }
                    function addMinutes(startDate, minutes) {

                        var result = new Date(startDate);



                        result.setMinutes(result.getMinutes() + minutes);

                        console.log(result);



                        return result;

                    }


// 使用示例

                    var startDate = new Date();

                    var jobDays = job[1]; // 假设 job[1] 是要添加的天数

                    var newStartDate = addMinutes(startDate, jobDays);


// 然后将 newStartDate 用作任务的开始日期
                    var from_to = "|O" + job[3] + '|D'+job[4]+'|'
                    tasks.push({

                        id: taskIndex++,

                        text: "J" + job[0] + from_to,

                        start_date: newStartDate,

                        duration: job[2] - job[1],

                        parent: meachine_ganttData.length+m + 1,

                        progress: 0.0,

                        open: false,

                        color: colors[(job[0]) % colors.length]

                    });

                }

                var task=tasks[meachine_ganttData.length+m]

                if (task) {

                    if (total_time !== 0) {

                        // 计算 use_rate 并保留两位小数

                        task.use_rate = (use_time / total_time * 100).toFixed(2) + '%';
                        task.wait_rate= ((1-use_time / total_time) * 100).toFixed(2) + '%';

                    } else {

                        // 如果 total_time 为 0，可以设置 use_rate 为 0% 或其他默认值

                        task.use_rate = '0%';
                        task.wait_rate='0%';


                    }

                }

            }



            return tasks;

        })(),

        links: []

    });


    // Set date format
    //gantt.config.start_date = this.nowDate.format('YYYY-MM-DD')
    //gantt.config.end_date = this.newDate.format('YYYY-MM-DD')

    //    gantt.config.date_format = "%Y-%m-%d %H:%i:%s"; // Include seconds in date format
    //gantt.resize();


    // Adjust the view

    gantt.attachEvent("onGanttReady", function () {

        gantt.showDate(gantt.date.add(gantt.date.min, gantt.date.day, 1));

        gantt.showDate(gantt.date.add(gantt.date.max, gantt.date.day, 10));

    });

</script>

</body>
</html>
