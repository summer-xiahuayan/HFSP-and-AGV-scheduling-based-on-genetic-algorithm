<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HFSP-and-AGV-scheduling-based-on-genetic-algorithm</title>
    <link rel="stylesheet" href="dhtmlxgantt.css" type="text/css">
    <script src="dhtmlxgantt.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #button-container {

            display: flex;

            justify-content: center;

            align-items: center;

            width: 100%;

            height: 50px; /* 设置一个高度 */

            background-color: #007bff; /* 背景颜色 */

            color: #fff; /* 文字颜色 */

            position: fixed; /* 固定在页面顶部 */

            top: 0; /* 顶部位置 */

            left: 0;

            z-index: 1000; /* 确保在gantt图上方 */

        }



        #button-container:hover {

            background-color: #0056b3; /* 鼠标悬停时的背景颜色 */

        }



        #toggleRenderButton {

            color: #fff; /* 文字颜色 */

            background: none; /* 无背景 */

            border: none; /* 无边框 */

            padding: 0; /* 无内边距 */

            font-size: 40px; /* 字体大小 */
            width: 100%;

            cursor: pointer; /* 鼠标指针 */

            text-transform: uppercase; /* 大小写字母 */

            letter-spacing: 0.05em; /* 字母间距 */

        }



        #gantt_here {

            width: 100%;

            height: calc(100vh - 50px);

            position: fixed; /* 修改为fixed定位 */

            top: 50px; /* 给gantt图顶部留出按钮的高度 */

            left: 0; /* 确保元素从视口的左侧开始 */

            overflow-y: auto; /* 如果内容超出，则显示垂直滚动条 */

        }

        .gantt_tree {

            text-align: left; /* 任务名称左对齐 */

        }



        .gantt_grid_data {

            text-align: center; /* 其他数值列居中对齐 */

        }


        .gantt_task_content {

            font-weight: bold !important;

            font-size: 13px;

        }


    </style>
</head>
<body>

<div id="button-container">

    <button id="toggleRenderButton">Scheduling Gantt Chart</button>

</div>



<div id="gantt_here" style=""></div>


<script>
    gantt.config.columns = [

        {name: "text", label: "Meachines", width: 130, tree: true}, // tree: true 以显示展开图标

        {name: "start_date", label: "Start Time", width: 80, template: gantt.formatDate},

        {name: "duration", label: "Duration", width: 70},

        {name: "use_rate", label: "Use Rate", width: 70},

        {name: "wait_rate", label: "Wait Rate", width:70},

        {name: "block_rate", label: "Block Rate", width:70},

    ];


    gantt.config.duration_unit = "minute"; // Set duration unit to seconds

    gantt.config.date_format = "%Y-%m-%d %H:%i:%s"; // 确保刻度和时间线上显示时分秒

    gantt.config.task_date_format = "%Y-%m-%d %H:%i:%s"; // 确保任务列表中显示时分秒

    gantt.config.date_scale = "%H:%i";
    gantt.config.scale_unit = "minute";

    gantt.config.scale_height = 40; // Set scale height for each machine

    gantt.config.row_height = 40; // Set row height for each task

    gantt.config.min_column_width = 35; // Minimum width for the columns

    //gantt.config.readonly = true;
    var meachine_ganttData = [[[6, 48.0, 119.0, 1], [11, 119.0, 179.0, 1], [14, 179.0, 244.0, 1], [15, 244.0, 335.0, 1], [8, 335.0, 410.0, 1], [3, 410.0, 465.0, 1]], [[1, 50.0, 77.0, 1], [2, 77.0, 113.0, 1], [4, 113.0, 158.0, 1], [16, 158.0, 240.0, 1], [7, 240.0, 281.0, 1], [20, 281.0, 318.0, 1], [17, 318.0, 342.0, 1], [5, 342.0, 435.0, 1]], [[12, 53.0, 124.0, 1], [13, 124.0, 198.0, 1], [10, 198.0, 266.0, 1], [19, 266.0, 319.0, 1], [9, 319.0, 384.0, 1], [18, 384.0, 478.0, 1]], [[1, 115.0, 128.0, 2], [6, 129.0, 188.0, 2], [11, 188.0, 220.0, 2], [13, 220.0, 304.0, 2], [14, 304.0, 372.0, 2], [20, 372.0, 396.0, 2], [19, 396.0, 436.0, 2], [17, 436.0, 523.0, 2], [8, 523.0, 592.0, 2], [3, 592.0, 653.0, 2]], [[2, 123.0, 156.0, 2], [12, 156.0, 163.0, 2], [4, 165.0, 251.0, 2], [16, 251.0, 319.0, 2], [10, 319.0, 351.0, 2], [7, 351.0, 406.0, 2], [15, 406.0, 483.0, 2], [9, 483.0, 558.0, 2], [5, 558.0, 612.0, 2], [18, 612.0, 653.0, 2]], [[1, 133.0, 216.0, 3], [11, 225.0, 247.0, 3], [13, 309.0, 341.0, 3], [14, 377.0, 473.0, 3], [17, 528.0, 601.0, 3], [3, 658.0, 685.0, 3]], [[2, 164.0, 259.0, 3], [16, 327.0, 372.0, 3], [20, 406.0, 429.0, 3], [19, 446.0, 452.0, 3], [15, 491.0, 566.0, 3], [8, 602.0, 681.0, 3]], [[12, 177.0, 179.0, 3], [6, 204.0, 247.0, 3], [4, 265.0, 317.0, 3], [10, 365.0, 388.0, 3], [7, 420.0, 476.0, 3], [9, 572.0, 583.0, 3], [5, 626.0, 656.0, 3], [18, 667.0, 674.0, 3]], [[12, 184.0, 211.0, 4], [6, 252.0, 340.0, 4], [2, 340.0, 358.0, 4], [13, 358.0, 421.0, 4], [10, 421.0, 506.0, 4], [14, 506.0, 576.0, 4], [15, 577.0, 643.0, 4], [17, 643.0, 692.0, 4], [8, 692.0, 733.0, 4]], [[1, 234.0, 327.0, 4], [11, 327.0, 355.0, 4], [4, 355.0, 399.0, 4], [16, 399.0, 473.0, 4], [20, 473.0, 506.0, 4], [19, 506.0, 530.0, 4], [7, 530.0, 604.0, 4], [9, 604.0, 669.0, 4], [5, 669.0, 673.0, 4], [18, 681.0, 713.0, 4], [3, 713.0, 720.0, 4]]];
    var agv_ganttData =[[[0, 0.0, 42.0, 11, 0], [6, 42.0, 48.0, 0, 1], [0, 48.0, 54.0, 1, 0], [4, 54.0, 62.0, 0, 2], [0, 62.0, 70.0, 2, 0], [14, 70.0, 76.0, 0, 1], [0, 76.0, 82.0, 1, 0], [19, 82.0, 93.0, 0, 3], [0, 93.0, 104.0, 3, 0], [8, 104.0, 110.0, 0, 1], [0, 110.0, 116.0, 1, 0], [3, 116.0, 122.0, 0, 1], [0, 122.0, 122.0, 1, 1], [6, 122.0, 129.0, 1, 4], [0, 153.0, 158.0, 4, 2], [4, 158.0, 165.0, 2, 5], [0, 170.0, 179.0, 5, 1], [11, 179.0, 186.0, 1, 4], [0, 196.0, 198.0, 4, 3], [13, 198.0, 200.0, 3, 4], [0, 235.0, 240.0, 4, 2], [16, 240.0, 247.0, 2, 5], [0, 262.0, 266.0, 5, 3], [10, 266.0, 270.0, 3, 5], [0, 274.0, 281.0, 5, 2], [7, 281.0, 288.0, 2, 5], [0, 311.0, 318.0, 5, 2], [20, 318.0, 323.0, 2, 4], [0, 328.0, 335.0, 4, 1], [15, 335.0, 344.0, 1, 5], [0, 380.0, 384.0, 5, 3], [9, 384.0, 388.0, 3, 5], [0, 401.0, 410.0, 5, 1], [8, 410.0, 417.0, 1, 4], [0, 430.0, 435.0, 4, 2], [5, 435.0, 442.0, 2, 5], [0, 456.0, 465.0, 5, 1], [3, 465.0, 472.0, 1, 4], [0, 476.0, 478.0, 4, 3], [18, 478.0, 482.0, 3, 5], [0, 483.0, 483.0, 5, 5], [15, 483.0, 491.0, 5, 7], [0, 513.0, 523.0, 7, 4], [17, 523.0, 528.0, 4, 6], [0, 555.0, 558.0, 6, 5], [9, 558.0, 572.0, 5, 8], [0, 576.0, 592.0, 8, 4], [8, 592.0, 602.0, 4, 7], [0, 604.0, 612.0, 7, 5], [5, 612.0, 626.0, 5, 8], [0, 637.0, 653.0, 8, 4], [3, 653.0, 658.0, 4, 6], [0, 663.0, 674.0, 6, 8], [18, 674.0, 681.0, 8, 10]], [[0, 0.0, 42.0, 11, 0], [1, 42.0, 50.0, 0, 2], [0, 50.0, 58.0, 2, 0], [11, 58.0, 64.0, 0, 1], [0, 64.0, 70.0, 1, 0], [10, 70.0, 81.0, 0, 3], [0, 81.0, 92.0, 3, 0], [20, 92.0, 100.0, 0, 2], [0, 100.0, 108.0, 2, 0], [5, 108.0, 116.0, 0, 2], [0, 116.0, 116.0, 2, 2], [2, 116.0, 123.0, 2, 5], [0, 235.0, 244.0, 5, 1], [14, 244.0, 251.0, 1, 4], [0, 317.0, 319.0, 4, 3], [19, 319.0, 321.0, 3, 4], [0, 337.0, 342.0, 4, 2], [17, 342.0, 347.0, 2, 4], [0, 349.0, 351.0, 4, 5], [10, 351.0, 365.0, 5, 8], [0, 380.0, 396.0, 8, 4], [20, 396.0, 406.0, 4, 7], [0, 426.0, 436.0, 7, 4], [19, 436.0, 446.0, 4, 7], [0, 645.0, 653.0, 7, 5], [18, 653.0, 667.0, 5, 8], [0, 675.0, 681.0, 8, 7], [8, 681.0, 692.0, 7, 9]], [[0, 0.0, 42.0, 11, 0], [12, 42.0, 53.0, 0, 3], [0, 53.0, 64.0, 3, 0], [16, 64.0, 72.0, 0, 2], [0, 72.0, 80.0, 2, 0], [7, 80.0, 88.0, 0, 2], [0, 88.0, 96.0, 2, 0], [9, 96.0, 107.0, 0, 3], [0, 107.0, 110.0, 3, 2], [1, 110.0, 115.0, 2, 4], [0, 122.0, 124.0, 4, 3], [12, 124.0, 128.0, 3, 5], [0, 156.0, 156.0, 5, 5], [2, 156.0, 164.0, 5, 7], [0, 178.0, 188.0, 7, 4], [6, 188.0, 204.0, 4, 8], [0, 204.0, 220.0, 8, 4], [11, 220.0, 225.0, 4, 6], [0, 248.0, 251.0, 6, 5], [4, 251.0, 265.0, 5, 8], [0, 288.0, 304.0, 8, 4], [13, 304.0, 309.0, 4, 6], [0, 316.0, 319.0, 6, 5], [16, 319.0, 327.0, 5, 7], [0, 362.0, 372.0, 7, 4], [14, 372.0, 377.0, 4, 6], [0, 403.0, 406.0, 6, 5], [7, 406.0, 420.0, 5, 8], [0, 423.0, 429.0, 8, 7], [20, 429.0, 442.0, 7, 10], [0, 455.0, 473.0, 10, 6], [14, 473.0, 489.0, 6, 9], [0, 555.0, 566.0, 9, 7], [15, 566.0, 577.0, 7, 9], [0, 578.0, 583.0, 9, 8], [9, 583.0, 590.0, 8, 10], [0, 649.0, 656.0, 10, 8], [5, 656.0, 663.0, 8, 10], [0, 667.0, 685.0, 10, 6], [3, 685.0, 703.0, 6, 10]], [[0, 0.0, 42.0, 11, 0], [2, 42.0, 50.0, 0, 2], [0, 50.0, 58.0, 2, 0], [13, 58.0, 69.0, 0, 3], [0, 69.0, 80.0, 3, 0], [15, 80.0, 86.0, 0, 1], [0, 86.0, 92.0, 1, 0], [17, 92.0, 100.0, 0, 2], [0, 100.0, 108.0, 2, 0], [18, 108.0, 119.0, 0, 3], [0, 126.0, 128.0, 3, 4], [1, 128.0, 133.0, 4, 6], [0, 160.0, 163.0, 6, 5], [12, 163.0, 177.0, 5, 8], [0, 179.0, 179.0, 8, 8], [12, 179.0, 184.0, 8, 9], [0, 200.0, 216.0, 9, 6], [1, 216.0, 234.0, 6, 10], [0, 240.0, 247.0, 10, 8], [6, 247.0, 252.0, 8, 9], [0, 252.0, 268.0, 9, 6], [11, 268.0, 286.0, 6, 10], [0, 286.0, 299.0, 10, 7], [2, 299.0, 310.0, 7, 9], [0, 312.0, 317.0, 9, 8], [4, 317.0, 324.0, 8, 10], [0, 324.0, 342.0, 10, 6], [13, 342.0, 358.0, 6, 9], [0, 361.0, 372.0, 9, 7], [16, 372.0, 385.0, 7, 10], [0, 385.0, 392.0, 10, 8], [10, 392.0, 397.0, 8, 9], [0, 441.0, 452.0, 9, 7], [19, 452.0, 465.0, 7, 10], [0, 469.0, 476.0, 10, 8], [7, 476.0, 483.0, 8, 10], [0, 583.0, 601.0, 10, 6], [17, 601.0, 617.0, 6, 9]]];
    var wait_rate =[0.0, 0.0, 0.0, 0.0018587360594795538, 0.0037735849056603774, 0.3967391304347826, 0.37524177949709864, 0.5492957746478874, 0.07650273224043716, 0.01646090534979424];
    var block_rate =[0.829736211031175, 0.7584415584415585, 0.7411764705882353, 0.6431226765799256, 0.7056603773584905, 0.0, 0.0, 0.0, 0.1766848816029144, 0.41358024691358025];
    var agv_block_rate =[0.16593245227606462, 0.14884393063583815, 0.15220483641536273, 0.21393841166936792];

    var colors = ["#15b01a", "#0343df", "#e50000", "#f97306", "#653700", "#929591", "#00ffff", "#6e750e",

        "#a03623", "#fac205", "#bf9005", "#029386", "#214761", "#ffd1df", "#e6daa6"];


    gantt.init("gantt_here");
    // 定义一个函数来切换render属性

    function toggleRender(m_index) {

        var taskId = m_index;

        var task = gantt.getTask(taskId);

        if (task) {

            task.render = task.render === 'split' ? 'box' : 'split';

            gantt.updateTask(taskId);

        }

    }



    // 给按钮添加点击事件监听器

    document.getElementById("toggleRenderButton").addEventListener("click", function() {

        // 假设你想要切换的任务索引是1（例如，"M1"）
        for (var m = 0; m < meachine_ganttData.length+agv_ganttData.length; m++) {
            toggleRender(m+1);
        }

// 重新计算甘特图的尺寸
        gantt.resize();
        // 滚动到甘特图的顶部
        gantt.scrollTo(0);

    });


    gantt.parse({

        data: (function () {

            var tasks = [];

            var taskIndex = 1;

            for (var m = 0; m < meachine_ganttData.length; m++) { // Iterate over machines
                var end_job = meachine_ganttData[m][meachine_ganttData[m].length - 1];
                var star_job = meachine_ganttData[m][0];
                var dur_time = end_job[2] - star_job[1]
                var m_index = m + 1

                var startDate = new Date(); // 获取当前日期和时间
                //var startDate = new Date();

                var startDays = star_job[1]; // 假设 job[1] 是要添加的天数
                function addDays(startDate, days) {

                    var result = new Date(startDate);

                    result.setDate(result.getDate() + days);
                    console.log(result)

                    return result;

                }
                function addMinutes(startDate, minutes) {

                    var result = new Date(startDate);



                    result.setMinutes(result.getMinutes() + minutes);

                    console.log(result);



                    return result;

                }

                var newStartDate = addMinutes(startDate, startDays);
                var wait=100*wait_rate[m]
                var block=100*block_rate[m]
                tasks.push({

                    id: taskIndex,

                    text: "M" + m_index,

                    start_date: newStartDate,//job[1],

                    duration: dur_time, // Convert days to seconds

                    parent: 0,

                    progress: 0.0,
                    wait_rate:wait.toFixed(2) + '%',
                    block_rate:block.toFixed(2) + '%',

                    open: false,
                    render: 'split',

                    color: '#007bff'// Job color

                });
                taskIndex++

            }

            for (var m = 0; m < agv_ganttData.length; m++) { // Iterate over machines
                var end_job = agv_ganttData[m][agv_ganttData[m].length - 1];
                var star_job = agv_ganttData[m][0];
                var dur_time = end_job[2] - star_job[1]
                var m_index = m + 1
                var block=100*agv_block_rate[m]
                var startDate = new Date(); // 获取当前日期和时间
                //var startDate = new Date();

                var startDays = star_job[1]; // 假设 job[1] 是要添加的天数
                function addDays(startDate, days) {

                    var result = new Date(startDate);

                    result.setDate(result.getDate() + days);
                    console.log(result)

                    return result;

                }
                function addMinutes(startDate, minutes) {

                    var result = new Date(startDate);



                    result.setMinutes(result.getMinutes() + minutes);

                    console.log(result);



                    return result;

                }

                var newStartDate = addMinutes(startDate, startDays);
                tasks.push({

                    id: taskIndex,

                    text: "AGV" + m_index,

                    start_date: newStartDate,//job[1],

                    duration: dur_time, // Convert days to seconds

                    parent: 0,
                    block_rate:block.toFixed(2) + '%',
                    progress: 0.0,

                    open: false,
                    render: 'split',

                    color: '#007bff'// Job color

                });
                taskIndex++

            }






            for (var m = 0; m < meachine_ganttData.length; m++) { // Iterate over machines
                var total_time=  meachine_ganttData[m][meachine_ganttData[m].length - 1][2]-meachine_ganttData[m][0][1];
                var use_time=0;

                for (var j = 0; j < meachine_ganttData[m].length; j++) { // Iterate over jobs

                    var job = meachine_ganttData[m][j];
                    use_time+=(job[2]-job[1]);

                    // 假设 startDate 是一个 Date 对象，days 是要添加的天数

                    function addDays(startDate, days) {

                        var result = new Date(startDate);

                        result.setDate(result.getDate() + days);
                        console.log(result)

                        return result;

                    }
                    function addMinutes(startDate, minutes) {

                        var result = new Date(startDate);



                        result.setMinutes(result.getMinutes() + minutes);

                        console.log(result);



                        return result;

                    }


// 使用示例

                    var startDate = new Date();

                    var jobDays = job[1]; // 假设 job[1] 是要添加的天数

                    var newStartDate = addMinutes(startDate, jobDays);


// 然后将 newStartDate 用作任务的开始日期
                    var op = "|T" + job[3] + '|'

                    tasks.push({

                        id: taskIndex++,

                        text: "J" + job[0] + op,

                        start_date: newStartDate,

                        duration: job[2] - job[1],

                        parent: m + 1,

                        progress: 0.0,

                        open: false,

                        color: colors[(job[0] - 1) % colors.length]

                    });

                }
                var task=tasks[m]

                if (task) {

                    if (total_time !== 0) {

                        // 计算 use_rate 并保留两位小数

                        task.use_rate = (use_time / total_time * 100).toFixed(2) + '%';

                    } else {

                        // 如果 total_time 为 0，可以设置 use_rate 为 0% 或其他默认值

                        task.use_rate = '0%';

                    }

                }

            }



            for (var m = 0; m < agv_ganttData.length; m++) { // Iterate over machines
                var total_time=  agv_ganttData[m][agv_ganttData[m].length - 1][2]-agv_ganttData[m][0][1];
                var use_time=0;

                for (var j = 0; j < agv_ganttData[m].length; j++) { // Iterate over jobs

                    var job = agv_ganttData[m][j];
                    use_time+=(job[2]-job[1])

                    // 假设 startDate 是一个 Date 对象，days 是要添加的天数

                    function addDays(startDate, days) {

                        var result = new Date(startDate);

                        result.setDate(result.getDate() + days);
                        console.log(result)

                        return result;

                    }
                    function addMinutes(startDate, minutes) {

                        var result = new Date(startDate);



                        result.setMinutes(result.getMinutes() + minutes);

                        console.log(result);



                        return result;

                    }


// 使用示例

                    var startDate = new Date();

                    var jobDays = job[1]; // 假设 job[1] 是要添加的天数

                    var newStartDate = addMinutes(startDate, jobDays);


// 然后将 newStartDate 用作任务的开始日期
                    var from_to = "|O" + job[3] + '|D'+job[4]+'|'
                    tasks.push({

                        id: taskIndex++,

                        text: "J" + job[0] + from_to,

                        start_date: newStartDate,

                        duration: job[2] - job[1],

                        parent: meachine_ganttData.length+m + 1,

                        progress: 0.0,

                        open: false,

                        color: colors[(job[0] - 1) % colors.length]

                    });

                }

                var task=tasks[meachine_ganttData.length+m]

                if (task) {

                    if (total_time !== 0) {

                        // 计算 use_rate 并保留两位小数

                        task.use_rate = (use_time / total_time * 100).toFixed(2) + '%';
                        task.wait_rate= ((1-use_time / total_time) * 100).toFixed(2) + '%';

                    } else {

                        // 如果 total_time 为 0，可以设置 use_rate 为 0% 或其他默认值

                        task.use_rate = '0%';
                        task.wait_rate='0%';


                    }

                }

            }



            return tasks;

        })(),

        links: []

    });


    // Set date format
    //gantt.config.start_date = this.nowDate.format('YYYY-MM-DD')
    //gantt.config.end_date = this.newDate.format('YYYY-MM-DD')

    //    gantt.config.date_format = "%Y-%m-%d %H:%i:%s"; // Include seconds in date format
    //gantt.resize();


    // Adjust the view

    gantt.attachEvent("onGanttReady", function () {

        gantt.showDate(gantt.date.add(gantt.date.min, gantt.date.day, 1));

        gantt.showDate(gantt.date.add(gantt.date.max, gantt.date.day, 10));

    });

</script>

</body>
</html>
